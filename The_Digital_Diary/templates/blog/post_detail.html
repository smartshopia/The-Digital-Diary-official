{% extends "base.html" %}
{% load static %}
{% block title %}
Home | The Digital Diary
{% endblock %}
{% block content %}
    <style>
    .container-post {
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background-color: #fff;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    .image-container-post {
    width: 100%;
    height: 100%;
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    }
    </style>


    <div class="container-post">
    <h1>{{ post.title }}</h1>
    <p>by {{ post.author.get_full_name }}</p>
    <p>{{ post.created_at }}</p>
    <div class="image-container-post">
      {% if post.image %}
      <img src="{{ post.image.url }}" alt="{{ post.title }}" style="width: 100%;">
      {% endif %}
    </div>
    <p>{{ post.content|safe }}</p>
    </div>
    <div class="container-post">
      <form method="POST" action="{% url 'like_post' post.pk %}">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary">
              Like ({{ post.total_likes }})
          </button>
      </form>
      </button>
      <button class="btn btn-outline-secondary" onclick="sharePost()">Share</button>
      <span>Shares: {{ post.share_count }}</span>
  </div>
      <div>
    <div class="container-post">
    <h2>Comments</h2>
    {% for comment in comments %}
        <p><strong>{{ comment.author.get_full_name }}</strong> {{ comment.created_at }}</p>
        <p>{{ comment.text }}</p>
    {% endfor %}
  </div>
  </div>
    <script>
        function sharePost() {
            navigator.share({
                title: '{{ post.title }}',
                url: window.location.href
            }).then(() => {
                console.log('Successfully shared');
            }).catch((error) => {
                console.error('Error sharing:', error);
            });
        }
    </script>
</div>
<script>
    document.getElementById('like-btn').addEventListener('click', function() {
        fetch('{% url "like_post" post.pk %}')
        .then(response => response.json())
        .then(data => {
            document.getElementById('like-btn').innerText = `Like (${data.total_likes})`;
        });
    });
</script>
<div class="container-post">
    <h2>Add a comment</h2>
    {% if user.is_authenticated %}
        {% if new_comment %}
            <p>Your comment has been added.</p>
        {% else %}
            <form method="post">
                {% csrf_token %}
                {{ comment_form.as_p }}
                <button type="submit">Add comment</button>
            </form>
        {% endif %}
    {% else %}
        <p>You need to <a href="{% url 'login' %}">login</a> to add a comment.</p>
    {% endif %}
</div>
{% endblock %}
